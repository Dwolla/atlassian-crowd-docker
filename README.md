# Atlassian Crowd Docker Image

[![](https://images.microbadger.com/badges/image/dwolla/atlassian-crowd.svg)](https://microbadger.com/images/dwolla/atlassian-crowd)
[![license](https://img.shields.io/github/license/dwolla/atlassian-crowd-docker.svg?style=flat-square)](https://github.com/Dwolla/atlassian-crowd-docker/blob/master/LICENSE.md)

Docker image with Atlassian Crowd, running on OpenJDK 8 / Alpine Linux with MySQL drivers.

## Required Environment Variables

### `DATABASE_CONFIG_OBJECT`

Path to an S3 object (e.g. `s3://bucket/object.json`) structured as follows:

```
{
  "crowd": {
    "user": "username",
    "password": "password",
    "host": "mysql.database.hostname",
    "port": "3306",
    "database": "crowd"
  }
}
```

The [`docker/start.sh`](https://github.com/Dwolla/atlassian-crowd-docker/blob/master/docker/start.sh) script, which runs on container startup, will retrieve the given object and use its contents to set up a JNDI resource named `jdbc/CrowdDS`:

```
  <Resource name="jdbc/CrowdDS"
            auth="Container"
            type="javax.sql.DataSource"
            username="\(.crowd.user)"
            password="\(.crowd.password)"
            driverClassName="com.mysql.jdbc.Driver"
            url="jdbc:mysql://\(.crowd.host):\(.crowd.port)/\(.crowd.database)?autoReconnect=true&amp;characterEncoding=utf8&amp;useUnicode=true"
            maxTotal="30"
            maxIdle="4" />
```

### `CROWD_CONFIG_OBJECT`

Path to an S3 object structured as follows:

```
{
  "crowdServerId": "B9AN-B9AN-B9AN-B9AN",
  "license": "AAABGQ0ODAoPeNpdkF1LwzAUhu/plus-some-more-stuff"
}
```

Both of these values can be found in [Atlassian licensing](http://my.atlassian.com/products/index).

### `CROWD_SECRETS_OBJECT`

As optional path to an S3 object structured as follows:

```
{
  "application_password": ""
}
```

Create this file to persist an application password between container instances.

### `CROWD_SERVER_URL`

The URL to your Crowd instance, once itâ€™s up and running.

### `CATALINA_OPTS`

Give your Crowd instance more memory by setting `CATALINA_OPTS` to e.g. `-Xms512m -Xmx512m`.

### `CROWD_TLS_SUBJ`

The TLS subject for the self-signed certificate generated by the startup script. For example,

```
/C=US/ST=Iowa/L=Des Moines/O=Dwolla/CN=localhost/emailAddress=your-email-address@localhost"
```

